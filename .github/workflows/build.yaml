name: Build and Deploy to Develop

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout this repo
      uses: actions/checkout@v3
    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2/repository
        key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
        restore-keys: |
          ${{ runner.os }}-maven-
    - name: Set up JDK 1.8
      uses: actions/setup-java@v3
      with:
        distribution: 'zulu'
        java-version: 8
    - name: Create Maven settings.xml
      uses: whelk-io/maven-settings-xml-action@v5
      with: 
        servers: '[{"id": "anypoint-exchange-v3", "username":"~~~Client~~~", "password":"8f29fed241c84c249d9c02b65c29c255~?~68cd59DF9D9B40A3AF69329d4D2aDE42"}, {"id": "non-production-automated-deployment", "username":"~~~Client~~~", "password":"6be4b9be43b048fca8667232fdf2cfdf~?~3Bd2C333b29543BC9a796336857a8A91"}]'
        repositories: '[{"id": "mule-releases-ee-repository" , "url": "https://repository.mulesoft.org/nexus-ee/content/repositories/releases-ee/"}, {"id":"mule-public-repository", "url":"https://repository.mulesoft.org/nexus/content/repositories/public"}]'
    - run: |
        cat ~/.m2/settings.xml

    - name: Build with Maven
      run: mvn clean deploy
        
#  deploy:
#    needs: build
#    runs-on: ubuntu-latest
#    steps:    
#    - name: Checkout this repo
#      uses: actions/checkout@v3
#    - name: Cache dependencies
#      uses: actions/cache@v3
#      with:
#        path: ~/.m2/repository
#        key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
#        restore-keys: |
#          ${{ runner.os }}-maven-
#    - uses: actions/download-artifact@v3
#      with:
#        name: artifacts
#    - name: Deploy to Sandbox
#      env:
#        USERNAME: ${{ secrets.anypoint_platform_username }}
#        PASSWORD: ${{ secrets.anypoint_platform_password }}
#      run: |
#        artifactName=$(ls *.jar | head -1)
#        mvn deploy -DmuleDeploy \
#         -Dmule.artifact=$artifactName \
#         -Danypoint.username="$USERNAME" \
#         -Danypoint.password="$PASSWORD" 